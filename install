# This file is used to bootstrap the installation of showoci_cloudshell on your OCI Cloud Shell session
# It works best when grabbed with curl or similar tools and then piped to bash for step-by-step execution
#
# Execute this command in your Cloud Shell session:
# curl -L --silent https://raw.github.com/kral2/showoci_cloudshell/main/install | bash

# Identify the latest GitHub Release
# see https://blog.markvincze.com/download-artifacts-from-a-latest-github-release-in-sh-and-powershell/
LATEST_RELEASE=$(curl -L -s -H 'Accept: application/json' https://github.com/kral2/showoci_cloudshell/releases/latest)
LATEST_RELEASE_TAG=$(echo $LATEST_RELEASE | sed -e 's/.*"tag_name":"\([^"]*\)".*/\1/')

# get the installer
echo ""
echo "*** Installing showoci_cloudshell $LATEST_RELEASE_TAG"
git clone https://github.com/kral2/showoci_cloudshell.git showoci_cloudshell_install --quiet

# execute the installer
cd showoci_cloudshell_install/install_on_cloudshell || exit
git checkout "$LATEST_RELEASE_TAG" --quiet
ansible-playbook main_showoci.yml

# cleanup
cd .. || exit
rm -rf showoci_cloudshell_install